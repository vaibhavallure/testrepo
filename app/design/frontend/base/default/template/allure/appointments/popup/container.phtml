<?php

/**
 * nordstorm popup
 */
?>
<div id="appointments-popup-wrapper">
    <?php if(Mage::getSingleton("core/session")->getData('appointment_submitted')):
        echo $this->getChildHtml('appointments_popup_success');
    endif;
    ?>
    <?php echo $this->getChildHtml("appointments_popup_top");?>
    <?php echo $this->getChildHtml("appointments_popup_menu");?>

    <?php echo $this->getChildHtml("appointments_popup_register");?>
    <?php echo $this->getChildHtml("appointments_popup_about");?>
    <?php echo $this->getChildHtml("appointments_popup_faq");?>
    <?php echo $this->getChildHtml("appointments_popup_footer");?>
</div>

<script type="text/javascript">
    if (typeof Allure == "undefined") {
        var Allure = {};
    }
    Allure.appointmentId = '<?php echo $this->getRequest()->getParam('id')?>';

    Allure.ajaxGetTimeUrl = '<?php echo $this->getTimeActionUrl()?>';
    Allure.ajaxGetWorkingDaysUrl = '<?php echo $this->getWorkingDaysActionUrl()?>';
    Allure.getSupportDetailsActionUrl = '<?php echo $this->getSupportDetailsActionUrl()?>';

    Allure.getSlotAvailabilityUrl = '<?php echo $this->getSlotAvailabilityUrl()?>';
    Allure.getDateAvailabilityUrl = '<?php echo $this->getDateAvailabilityUrl()?>';

    function formatDate(date) {
        var monthNames = [
            "Jan", "Feb", "Mar",
            "Apr", "May", "Jun", "Jul",
            "Aug", "Sep", "Oct",
            "Nov", "Dec"
        ];

        var day = date.getDate();
        var monthIndex = date.getMonth();
        var year = date.getFullYear();

        return monthNames[monthIndex] + ' ' +  day + ', ' + year;
    }
</script>

<script type="text/javascript">
        var appointmentForm = new VarienForm('appointemnet_form');

        Allure.UtilPath = "<?= Mage::getDesign()->getSkinUrl(); ?>js/phone_validation/utils.js";

        //initialize itel tel input
        var input = document.querySelector("#phonenumber")
        var iti = window.intlTelInput(input, {
            autoFormat: false,
            autoHideDialCode: false,
            autoPlaceholder: false,
            nationalMode: false,
            utilsScript: Allure.UtilPath
        });

        var country_code = "<?= Mage::getSingleton('allure_geolocation/geoLocation')->getCountryCode();?>";

        if (country_code == undefined || country_code == null || country_code == "") {
            country_code = "us"
        }

        iti.setCountry(country_code.toLowerCase());

        //custom validator for itel tel input
        //FileName - intel-tel-validation.js
        allureIntlTelValidate(jQuery("#phonenumber"),iti);
</script>
