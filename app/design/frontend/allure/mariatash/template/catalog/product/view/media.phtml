<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_modern
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product media data template
 *
 * @see Mage_Catalog_Block_Product_View_Media
 */
?>
<?php header('X-Frame-Options: GOFORIT'); ?>

<?php
$isAjaxCall = $this->getRequest()->getControllerName() == 'media' && $this->getRequest()->getActionName() == 'index';
$_product = $this->getProduct();
$_cpid =  $this->getRequest()->getParam("cpid") ? $this->getRequest()->getParam("cpid") : $_product->getId();
$configProduct = Mage::getModel('catalog/product')->load($_cpid);
$childId = null;
if($configProduct->isConfigurable()){
    $check_option_color = false;
    $allowAttrs   = array();
    $allAtributes = $configProduct->getTypeInstance(true)->getConfigurableAttributes($configProduct);
    foreach ($allAtributes as $attribute) {
        $productAttribute = $attribute->getProductAttribute();
        $attrid = $productAttribute->getId();
        $allowAttrs[] = $productAttribute->getAttributeCode();         
    }
    $colors = Mage::getStoreconfig('ecp_color/color_attr');
    $colors = explode(",", $colors);
    foreach($allowAttrs as $cd){
        if( in_array($cd,$colors)){
            $check_option_color = true;
            break;
        }
    }
    
    $colorOptionId = $this->getRequest()->getParam("optionId");  
    
    $childProducts = Mage::getModel('catalog/product_type_configurable')->getUsedProducts(null, $configProduct);
    $config_attr = null;   
    if(count($allowAttrs) == 1){
        $config_attr = $allowAttrs[0];           
    }
    else{           
       
        foreach($colors as $code){
            if(in_array($code, $allowAttrs)){
                $config_attr = $code; 
                break;
            }
        }
        $realAttribute = @array_diff($config_attr,$colors);
        if(count($realAttribute)) $config_attr   = $realAttribute[0];            
    }
   
    if($colorOptionId){
        foreach($childProducts as $prod){     
            $method = 'get'.ucfirst($config_attr);
            $attribute_code = $prod->$method();                             
            if($colorOptionId == $attribute_code){
                $childId = $prod->getEntityId();
                break;
            }
        }
        foreach($childProducts as $prod){     
            $method = 'get'.ucfirst($config_attr);
            $attribute_code = $prod->$method();                             
            if($colorOptionId == $attribute_code){
                if($prod->getVideo()) {
                        $_cpid = $prod->getEntityId();
                        $configProduct = Mage::getModel('catalog/product')->load($_cpid);
                        break;
                } 
            }
        }
    }
    // Non color attribute
    else{
        foreach($childProducts as $prod){     
            $method = 'get'.ucfirst($config_attr);
            $attribute_code = $prod->$method();                             
            $colorOptionId  = $attribute_code;
            $childId = $prod->getEntityId();
            break;
        }       
    } 
}

$_helper = $this->helper('catalog/output');
?>
<?php 
if($childId){
    $_product = Mage::getModel('catalog/product')->load($childId);      
}
$gallery = $_product->getMediaGalleryImages();
$typeId   = $_product->getTypeId();
$videoUrl = $_product->getVideo(); //Get video from simple product
$thumb    = $_product->getVideoThumb();
$secondVideoUrl = $_product->getSecondVideo(); //Get video from simple product
$secondThumb    = $_product->getSecondVideoThumb();
if (!$videoUrl && $secondVideoUrl)
{
    $videoUrl = $secondVideoUrl;
    $thumb = $secondThumb;
    $secondVideoUrl = null;
    $secondThumb = null;
}
?>
<?php $count = count($gallery); ?>

<div count="<?php echo $count?>" class="product-image product-image-slider relative m_bottom_3" style="position: relative">
    <div class="product-image-gallery owl-carousel owl-theme" id="image_gallery" data-nav="image_gallery_product_" data-owl-carousel-options='{
			"responsive" : {
				"0" : {
					"items" : 1
				},
				"321" : {
					"items" : 1
				},
				"769" : {
					"items" : 1
				},
				"992" : {
					"items" : 1
				}
			},
			"stagePadding" : 10,
			"margin" : 10,
			"navigation":true,
			"singleItem":true,
			"URLhashListener" : false
		}'>	
		<?php 
			$imageList = array();
		?>

        <?php $i=0; foreach ($gallery as $_image): ?>
        	<?php 
        		$galleryImage = (string) $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->resize(392,512);
        		$galleryImageZoom = (string) $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
        		
            	if (!in_array($galleryImage, $imageList)) :
            		$imageList[] = $galleryImage;
	            ?>
	            <img id="image-<?php echo $i; ?>"
	                 class="gallery-image"
	                 src="<?php echo $galleryImage ?>"
	                 data-zoom="<?php echo $galleryImageZoom ?>"/>
            <?php endif; ?>
        <?php $i++; endforeach; ?>
           
	    <?php if($videoUrl):?><!-- Check video url-->
	    <?php
	     $videoUrl = str_replace('&autoplay=1', '', $videoUrl);
	     $videoUrl = str_replace('&amp;autoplay=1', '', $videoUrl);
	     $videoIsYT = false;
	     if (strpos($videoUrl, 'youtube.com') != false) {                     
	            $videoUrl = str_replace('watch?v=', 'embed/', $configProduct->getVideo());
	            $videoIsYT = true;
	     }  
	     if(strpos($videoUrl,'?')!= false) {
	         $videoUrl.= '&autoplay=0';
	     }else{
	         $videoUrl.= '?autoplay=0';   
	     }
	    ?>
	     <div class="containerVideo containerVideo_first" id="video-<?php echo $_product->getTypeId(); ?>">
	            <iframe src="<?php echo $videoUrl;?>" width="323" height="422" frameborder="0" id="video_first" ></iframe>
	    </div>
	    <?php endif;?><!-- end check video -->
	    <?php if($secondVideoUrl):?><!-- Check Second video url-->
	    <?php
	    $secondVideoUrl = str_replace('&autoplay=1', '', $secondVideoUrl);
	    $secondVideoUrl = str_replace('&amp;autoplay=1', '', $secondVideoUrl);
	    $secondVideoIsYT = false;
	    if (strpos($secondVideoUrl, 'youtube.com') != false) {
	        $secondVideoUrl = str_replace('watch?v=', 'embed/', $configProduct->getVideo());
	        $secondVideoIsYT = true;
	    }
	    if(strpos($secondVideoUrl,'?')!= false) {
	        $secondVideoUrl.= '&autoplay=0';
	    }else{
	        $secondVideoUrl.= '?autoplay=0';
	    }
	    ?>
	    <div class="containerVideo containerVideo_second" id="video-<?php echo $_product->getTypeId(); ?>">
            <iframe src="<?php echo $secondVideoUrl;?>" width="323" height="422" frameborder="0" id="video_second" ></iframe>
	    </div>
	    <?php endif;?><!-- end check video -->
    </div>
</div>
<a  class="colorbox_media" id="zoom-btn" title="<?php echo $this->escapeHtml($this->getImageLabel()) ?> " href="<?php echo $this->helper('catalog/image')->init($_product, 'thumbnail') ?>"><i class="fa fa-plus-circle"></i></a>
<script>
var resizeVideo = function () {
	var $ = jQuery;
	var maxWidth = 0;
	var maxHeight = 0;
	var video;
	
	$('.owl-item').each(function(){
		var slide = $(this);
		video = $(this).find('iframe');
		if (!video.length && slide.width() > maxWidth) {
			maxWidth = slide.width();
		}
		if (!video.length && slide.height() > maxHeight) {
			maxHeight = slide.height();
		}
	});

	if (video && maxWidth) {
		video.attr('width',maxWidth);
	}

	if (video && maxHeight) {
		video.attr('height',maxHeight);
	}

	console.log ('VIDEO RESIZE DONE');
};
jQuery(document).ready(function($) {
	 $('.colorbox_media').colorbox({
		  overlayClose: true,
		  maxWidth:'95%',
		  rel:'colorbox_media',
		  height:"95%"
	}); 

	 resizeVideo();
	 $(window).resize(resizeVideo);
	/* $(".colorbox_media").colorbox({rel:'colorbox_media'});*/
});
</script>
<?php echo $this->getChildHtml('after'); ?>

<div id="gallery-wrapper" style="display: none">

<?php if ( $count >= 1 ): ?>
        <?php $counter = 1; ?>
        <div id="imageRepo">
            <?php foreach ($gallery as $_image): ?>
                <img src="<?php echo $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->resize(392,512); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" data="<?php echo $_image->getId();?>"/>
                <?php $counter++; ?>
            <?php endforeach; ?>
        </div>
        <div id="thumbRepo">
            <?php foreach ($gallery as $_image): ?>
                <img src="<?php echo $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->resize(74,96); ?>" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" title="<?php echo $this->htmlEscape($_image->getLabel()) ?>" data="<?php echo $_image->getId();?>" viewon="<?php echo $_image->getViewon() ?>"/>
                <?php $counter++; ?>
            <?php endforeach; ?>
        </div>
<?php endif   ?>

<script type="text/javascript">

function loadImage(numImage){
    jQuery(".containerImage").fadeIn(5000, function(){
        jQuery('.containerImage').html('<img src="'+jQuery('#imageRepo img').eq(numImage).attr('src')+'" data="'+jQuery('#imageRepo img').eq(numImage).attr('data')+'" />');
    });
}

function loadImageConf(numImage){
    jQuery(".containerImage").fadeIn(5000, function(){
        jQuery('.containerImage').html(imgArray[spConfig<?php echo $_product->getId(); ?>.getIdOfSelectedProduct()]['imageRepo'][numImage]);
    });
}

function loadBaseImage(){
    jQuery(".containerImage").fadeIn(5000, function(){
        <?php $_img = $this->helper('catalog/image')->init($_product, 'image')->resize(392,512); ?>
        jQuery('.containerImage').html('<img src="<?php echo $_helper->productAttribute($_product, $_img, 'image');?>"  data="0"/>');
    });
}

var loadTimes=0;
function loadVideo(video){
     var player = document.getElementById('video_' + video);
     if(player){
         var src = player.src;     
         if(src.search("autoplay=0") != -1){
            src = src.replace("autoplay=0","autoplay=1");
         }        
         player.src = src;         
     }
     jQuery('.containerVideo_' + video).show();
}

function closeVideo(){
    var player = jQuery('[id^="video_"]');
    if(player){
        player.each(function(index,iframe) {
            if (iframe.src) {
                src = iframe.src.replace("autoplay=1","autoplay=0");
                iframe.src = src;
            }
        });
    }
    jQuery('[class^="containerVideo_"]').hide();
}
function closeVid(){
    //jQuery('.containerVideo').hide();
}

function createZoomview(){
    jQuery.facybox.loading();
    <?php $url = $this->getUrl('productview/index/sendproduct'); ?>
    var widthWindow = (jQuery(window).width());
    var heightWindow = jQuery(window).height();
    var widthFullimage = widthWindow * 0.86;
    var heightFullimage = heightWindow;

    var widthThumbimage = widthWindow * 0.12;
    var heightThumbimage = heightWindow * 0.24;
    var productId = jQuery('input[name="product"]').val();
    var productName = jQuery.trim(jQuery('.product-view .product-name').text());
   jQuery(function(){
        jQuery.ajax({
            url: "<?php echo $url ?>",
            data: {
                product: productId,
                productName: productName,
                widthwindow:widthWindow,
                heightwindow:heightWindow,
                widthfullimage:widthFullimage,
                heightfullimage:heightFullimage,
                widththumbimage:widthThumbimage,
                heightthumbimage:heightThumbimage
            },

            success: function(data){
                jQuery.facybox(data, 'fullscreen-slide');
                jQuery('#facybox').css({top:0,left:0, margin: 0, padding: 0, position: 'fixed'});
                jQuery('a.close').hide();
            }
        });
    })
}

jQuery(document).ready(function(){
    /*********************************************************/
    /*Gallery View*/
    jQuery('.containerImage,.btnFullscreen').mouseover(function() {
       jQuery('.btnFullscreen').show();
    }).mouseout(function() {
       jQuery('.btnFullscreen').hide();
    });
    jQuery('#loader').hide();
	<?php $hasVideo = ($_product->getVideo()) ? $_product->getVideo() : (($_product->getSecondVideo()) ? $_product->getSecondVideo() : '');?>
    var videoCounter = <?php echo strlen($hasVideo)?>;
    var urlCounter = <?php echo strlen($_product->getUrl())?>;
    <?php if ( $count > 1 ): ?>
            var counterJs = 0;
            var numImages = jQuery('#thumbRepo img').length;
            var urlVideo = '';

            loadBaseImage();

            jQuery('#thumbRepo img').each(function(number){
                 if(jQuery(this).attr('viewon') == 1) {
                    if(numImages < 5)
                        jQuery('.thumb').eq(counterJs).html('<a href="javascript:;" onclick="closeVideo();loadImage('+counterJs+');"><div class="url-caption">VIEW ON MODEL</div><img src="'+jQuery(this).attr('src')+'" /></a>');
                    else {
                        jQuery('.thumb').eq(3).html('<div class="url-caption">VIEW ON MODEL</div><a href="javascript:;" onclick="closeVideo();loadImage('+counterJs+');"><img src="'+jQuery(this).attr('src')+'" /></a>');                        
                    }
                    counterJs++;
                } else {
                     if( videoCounter  == 0 ){
                        if(number <= 3){
                            jQuery('.thumb').eq(counterJs).html('<a href="javascript:;" onclick="closeVideo();loadImage('+counterJs+');"><img src="'+jQuery(this).attr('src')+'" /></a>');
                            counterJs++;
                        }

                     }
                     else{
                         if(number <= 3){
                            jQuery('.thumb').eq(counterJs).html('<a href="javascript:;" onclick="closeVideo();loadImage('+counterJs+');"><img src="'+jQuery(this).attr('src')+'" /></a>');
                            counterJs++;
                         }
                    }
               }
                
            });
            if( videoCounter  == 0 ){
                <?php //if ( $count == 0 ): ?>
                    if( urlCounter > 0 ){
                        jQuery('.thumb').eq(counterJs).html('<div class="url-caption">VIEW ON MODEL</div><a href="<?php echo $_product->getUrl();?>"><img src="<?php echo $this->getSkinUrl('images/catalog/product/placeholder/thumbProductview.jpg');?>" /></a>');
                    }
                <?php //endif; ?>
            }
            else{
                <?php
                if($_product->getVideoThumb() == 'thumbnail/video/')
                    $_product->setVideoThumb('thumbnail/video/galleryThumb-video.png');
                if($videoUrl){ ?>
                    var id_video = (counterJs > 3) ? 4 : counterJs;
                    jQuery('.thumb').eq(id_video).html('<div class="video-caption" onclick="loadVideo(\'first\');">VIDEO</div><a href="javascript:;" onclick="closeVideo();loadVideo(\'first\');"><img width="74" src="<?php echo Mage::helper('ecp_productview')->resizeImg($thumb , 74, 96); ?>" /></a>');
                <?php }
                if($secondVideoUrl){ ?>
                    var id_video = (counterJs > 3) ? 4 : counterJs;
                    jQuery('.thumb').eq(id_video+1).html('<div class="video-caption" onclick="loadVideo(\'second\');">VIDEO</div><a href="javascript:;" onclick="closeVideo();loadVideo(\'second\');"><img width="74" src="<?php echo Mage::helper('ecp_productview')->resizeImg($secondThumb , 74, 96); ?>" /></a>');
                <?php } ?>
                if( urlCounter > 0 ){
                    <?php //if( $_product->getUrlThumb() != 'thumbnail/url/' && $_product->getUrl() != '' ){ ?>
                    jQuery('.thumb').eq(counterJs).html('<div class="url-caption">VIEW ON MODEL</div><a href="<?php echo $_product->getUrl();?>"><img src="<?php echo Mage::helper('ecp_productview')->resizeImg($_product->getUrlThumb() , 75, 96); ?>" /></a>');
                    <?php //} ?>
                }
            }

    <?php endif; ?>

    <?php if ( $count == 1 ): ?>      
        loadBaseImage();       
        if (videoCounter == 0) {
            if (urlCounter > 0) {
                jQuery('.thumb').eq(0).html('<a href="<?php echo $_product->getUrl();?>"><img src="<?php echo $this->getSkinUrl('images/catalog/product/placeholder/thumbProductview.jpg');?>" /></a>');
            }
        } else {
            <?php if($_product->getVideoThumb() == 'thumbnail/video/')
                    $_product->setVideoThumb('thumbnail/video/galleryThumb-video.png');
            if($videoUrl){ ?>
                jQuery('#thumbRepo img').each(function(number){
                         jQuery('.thumb').eq(0).html('<a href="javascript:;" onclick="closeVideo();loadImage(0);"><img src="'+jQuery(this).attr('src')+'" /></a>');
                         return;
                });
                jQuery('.thumb').eq(1).html('<div class="video-caption" onclick="loadVideo(\'first\');">VIDEO</div><a href="javascript:;" onclick="closeVideo();loadVideo(\'first\');"><img width="74" src="<?php echo Mage::helper('ecp_productview')->resizeImg($thumb , 74, 96); ?>" /></a>');
            <?php }
            if($secondVideoUrl){ ?>
                jQuery('#thumbRepo img').each(function(number){
                    jQuery('.thumb').eq(0).html('<a href="javascript:;" onclick="closeVideo();loadImage(0);"><img src="'+jQuery(this).attr('src')+'" /></a>');
                    return;
                });
                jQuery('.thumb').eq(2).html('<div class="video-caption" onclick="loadVideo(\'second\');">VIDEO</div><a href="javascript:;" onclick="closeVideo();loadVideo(\'second\');"><img width="74" src="<?php echo Mage::helper('ecp_productview')->resizeImg($thumb , 74, 96); ?>" /></a>');
                <?php } ?>
            if (urlCounter > 0) {
                <?php if( $_product->getUrlThumb() != 'thumbnail/url/' && $_product->getUrl() != '' ){ ?>
                jQuery('.thumb').eq(2).html('<div class="url-caption">VIEW ON MODEL</div><a href="<?php echo $_product->getUrl();?>"><img src="<?php echo Mage::helper('ecp_productview')->resizeImg($_product->getUrlThumb() , 75, 96); ?>" /></a>');
                <?php } ?>
            }
        }

    <?php endif; ?>

    <?php if ( $count == 0 ): ?>
        jQuery('.containerImage').html('<img src="<?php echo $this->getSkinUrl('images/catalog/product/placeholder/imageProduct.jpg');?>" />');

        if( videoCounter  == 0 ){
        <?php //if ( $count == 0 ): ?>
            if( urlCounter > 0 ){
                jQuery('.thumb').eq(0).html('<a href="<?php echo $_product->getUrl();?>"><img src="<?php echo $this->getSkinUrl('images/catalog/product/placeholder/thumbProductview.jpg');?>" /></a>');
            }
        } else{
            <?php if( $_product->getVideoThumb() != 'thumbnail/video/' && $videoUrl){ ?>
                jQuery('.thumb').eq(0).html('<div class="video-caption" onclick="loadVideo();">VIDEO</div><a href="javascript:;" onclick="loadVideo();"><img width="74" src="<?php echo Mage::helper('ecp_productview')->resizeImg($thumb , 74, 96); ?>" /></a>');
                <?php } ?>
                if( urlCounter > 0 ){
                    <?php if( $_product->getUrlThumb() != 'thumbnail/url/' && $_product->getUrl() != '' ){ ?>
                    jQuery('.thumb').eq(1).html('<div class="url-caption">VIEW ON MODEL</div><a href="<?php echo $_product->getUrl();?>"><img src="<?php echo Mage::helper('ecp_productview')->resizeImg($_product->getUrlThumb() , 74, 96); ?>" /></a>');
                    <?php } ?>
                }
        }
    <?php endif; ?>
});

</script>
<input type="hidden" name="reloadmedia" id="reloadmedia" value="v"/>
<input type="hidden" name="check_option_color" id="check_option_color" value="<?php echo $check_option_color;?>"/>

<div class="gallery">    
    <?php if($videoUrl):?><!-- Check video url-->
    <?php
     $videoUrl = str_replace('&autoplay=1', '', $videoUrl);
     $videoUrl = str_replace('&amp;autoplay=1', '', $videoUrl);
     if (strpos($videoUrl, 'youtube.com') != false) {                     
            $videoUrl = str_replace('watch?v=', 'embed/', $configProduct->getVideo());
     }  
     if(strpos($videoUrl,'?')!= false) {
         $videoUrl.= '&autoplay=0';
     }else{
         $videoUrl.= '?autoplay=0';   
     }
    ?>
     <div class="containerVideo_first" id="video-<?php echo $_product->getTypeId(); ?>">
            <iframe src="<?php echo $videoUrl;?>" width="323" height="422" frameborder="0" id="video_first" ></iframe>
    </div>
    <?php endif;?><!-- end check video -->
    <?php if($secondVideoUrl):?><!-- Check Second video url-->
    <?php
    $secondVideoUrl = str_replace('&autoplay=1', '', $secondVideoUrl);
    $secondVideoUrl = str_replace('&amp;autoplay=1', '', $secondVideoUrl);
    if (strpos($secondVideoUrl, 'youtube.com') != false) {
        $secondVideoUrl = str_replace('watch?v=', 'embed/', $configProduct->getVideo());
    }
    if(strpos($secondVideoUrl,'?')!= false) {
        $secondVideoUrl.= '&autoplay=0';
    }else{
        $secondVideoUrl.= '?autoplay=0';
    }
    ?>
    <div class="containerVideo_second" id="video-<?php echo $_product->getTypeId(); ?>">
        <iframe src="<?php echo $secondVideoUrl;?>" width="323" height="422" frameborder="0" id="video_second" ></iframe>
    </div>
    <?php endif;?><!-- end check video -->
    <div class="btnFullscreen gradient" style="display:none;" onclick="createZoomview();">
		<span><span>View Fullscreen</span></span>
	</div>
    <div class="containerImage"></div>
    <div class="containerThumb">
        <div class="thumb thumb1"></div>
        <div class="thumb thumb2"></div>
        <div class="thumb thumb3"></div>
        <div class="thumb thumb4"></div>
        <div class="thumb thumb5"></div>
    </div>
</div>
<div id="zoomView"></div>
<?php
$matches ='';
preg_match('#(?<=v=)[a-zA-Z0-9-]+(?=&)|(?<=embed\/)[^"&\n]+|(?<=v\/)[^&\n]+|(?<=v=)[^&\n]+|(?<=youtu.be/)[^&\n]+#', $_product->getVideo(), $matches);
?>
<script>
	<?php if($this->getReloadYT()): ?>
		onYouTubeIframeAPIReady();
	<?php else: ?>
      		var tag = document.createElement('script');
      		tag.src = "http://www.youtube.com/iframe_api";
      		var firstScriptTag = document.getElementsByTagName('script')[0];
      		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

		var player;
	<?php endif; ?>

	      function onYouTubeIframeAPIReady() {
                  
	      }

      var done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.ENDED && !done) {
			player.playVideo();
	}else if (event.data == YT.PlayerState.PLAYING && !done) {
		jQuery('.btnClose').hide();
	}else if (event.data == YT.PlayerState.PAUSED && !done) {
		jQuery('.btnClose').show();
        }
      }

      function stopVideo() {
        player.stopVideo();
      }

    </script>
    <div style="display: none;" id="current_option_id"><?php echo $colorOptionId ;?></div>
    <script type="text/javascript">   
    var initSlider = function () {
        var $ = jQuery;

        var owl = $('.owl-carousel');
        owl.owlCarousel({items:1});
        // Listen to owl events:
        owl.on('changed.owl.carousel',function(event){
           var activeImage = $('.owl-item.active img');

           //console.log(activeImage);

           if (activeImage.length) {
        	   $("#zoom-btn").attr('href',activeImage.data('zoom')).show();
           } else {
        	   $("#zoom-btn").hide();
           }
        })
    };
    jQuery(document).ready(function(){
     
		 jQuery(document).ajaxSuccess(initSlider);

		 jQuery('.amconf-image').click(resizeVideo);

        var id = 'amconf-image-<?php echo $colorOptionId ;?>';
        
        /* Add tooltip for color icon*/
        jQuery('.amconf-images-container').each(function(){
                jQuery(this).find('img').each(function(){
                    var imgid  = jQuery(this).attr('id'),  
                        imgalt = jQuery(this).attr('alt'); 
                    Tipped.create(jQuery("#"+imgid), imgalt, {
                            skin: 'customTiny',
                            showOn: ['click', 'mouseover'],
                            background: { color: '#fff', opacity: .7 }
                    });
                });
            });   
         
        /* Attribute Post Length */
        if(jQuery('#attribute189').html()){
            var optionId = '<?php echo $colorOptionId;?>';            
            if(optionId){
                jQuery('#attribute189 option').each(function(){
                    if(jQuery(this).attr('value') == optionId && $('attribute189')){
                        $('attribute189').value = optionId;
                        $('attribute189').simulate('change');
                    }
                });
            }
        }
        var showStockMsg = '<?php echo ($_product->getStockItem()->getData('backorders') != 0 && $_product->getStockItem()->getData('qty') < 1) ? true : false ;?>';
        if(showStockMsg) {
            jQuery('.delayed-product').removeClass('display_none');
        } else {
            jQuery('.delayed-product').addClass('display_none');
        }   
             
        if (jQuery('#'+id)) {
            jQuery('#'+id).click();            
        }  
    });
</script>