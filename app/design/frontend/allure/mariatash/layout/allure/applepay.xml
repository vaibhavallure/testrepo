<?xml version="1.0"?>
<layout version="0.1.0">


    <!--
    Sidecart/Minicart Shortcut
    -->
    <default>
        <block type="allure_applepay/script" name="allure_applepay.script" template="allure/applepay/script.phtml">
            <action method="setIsDefault"><is_default>1</is_default></action>
        </block>
        <block type="allure_applepay/script" name="allure_applepay.script.async" template="allure/applepay/script_async.phtml" />
        <block type="allure_applepay/button" name="ApplePayButtonSideCart" template="allure/applepay/button.phtml"/>
        
        <reference name="head">
            <action method="append" ifconfig="payment/applepay/show_in_minicart">
                <block>allure_applepay.script</block>
            </action>
            	<action method="addItem"><type>skin_css</type><name>allure/applepay.css</name><params/></action>
        </reference>
        <reference name="before_body_end">
            <action method="append" ifconfig="payment/applepay/show_in_minicart">
                <block>allure_applepay.script.async</block>
            </action>
        </reference>
        <reference name="cart_sidebar.extra_actions">
            <action method="append" ifconfig="payment/applepay/show_in_minicart">
                <block>ApplePayButtonSideCart</block>
            </action>
        </reference>
    </default>

    <!--
    Cart
    -->
    <checkout_cart_index>

        <reference name="head">
            <block type="allure_applepay/script" name="allure_applepay.script" template="allure/applepay/script.phtml" />
        </reference>

        <reference name="before_body_end">
            <block type="allure_applepay/script" name="allure_applepay.script.async" template="allure/applepay/script_async.phtml" />
        </reference>

        <!-- To Move Apple Pay button around on the cart page, change the after="" attribute to before="" in the below block tags -->

        <reference name="checkout.cart.top_methods">
        		<block type="allure_applepay/button" after="-" name="ApplePayButtonTop" template="allure/applepay/button.phtml"/>
        </reference>

        <reference name="checkout.cart.methods">
        		<block type="allure_applepay/button" after="-" name="ApplePayButtonCart" template="allure/applepay/button_cart.phtml"/>
        </reference>

    </checkout_cart_index>


    <!--
    OnePage checkout
    -->
    <checkout_onepage_index>

        <reference name="head">
            <block type="allure_applepay/script" name="allure_applepay.script" template="allure/applepay/script.phtml" />
        </reference>

        <reference name="before_body_end">
            <block type="allure_applepay/script" name="allure_applepay.script.async" template="allure/applepay/script_async.phtml" />
        </reference>

        <reference name="checkout.onepage">
            <block type="allure_applepay/button" name="ApplePayButtonCheckout" template="allure/applepay/onepage/button.phtml"/>
        </reference>

        <reference name="checkout.onepage.login">
            <!-- Remove this to prevent "Login with Amazon" button from appearing on checkout -->
            <action method="setTemplate" ifconfig="payment/applepay/enabled">
                <template helper="allure_applepay/data/switchOnepageLoginTemplateIf">
                    <template_allure>allure_applepay/onepage/login.phtml</template_allure>
                    <template_default>checkout/onepage/login.phtml</template_default>
                 </template>
            </action>

            <block type="core/text_list" name="col1_before" />
            <block type="core/text_list" name="col2_before" />

            <reference name="col1_before">
                <block type="allure_applepay/button" name="ApplePayButtonBefore" template="allure/applepay/onepage/button.phtml"/>
            </reference>

            <reference name="col2_before">
                <block type="allure_applepay/button" name="ApplePayButtonAdditional" template="allure/applepay/onepage/button.phtml"/>
            </reference>
        </reference>

    </checkout_onepage_index>

    <!--
    Product View Shortcut
    -->
    <catalog_product_view>

        <block type="allure_applepay/button" name="ApplePayButtonProduct" template="allure/applepay/button_shortcut.phtml" />
        <block type="allure_applepay/script" name="allure_applepay.script" template="allure/applepay/script.phtml" />
        
        <reference name="head">
            <action method="append" ifconfig="payment/applepay/visible_on_product">
                <block>allure_applepay.script</block>
            </action>
        </reference>

        <reference name="before_body_end">
            <block type="allure_applepay/script" name="allure_applepay.script.async" template="allure/applepay/script_async.phtml" />
        </reference>

        <reference name="product.info.addtocart">
            <action method="append" ifconfig="payment/applepay/visible_on_product">
                <block>ApplePayButtonProduct</block>
            </action>
        </reference>

        <reference name="right">
            <block type="allure_applepay/button" name="allure_applepay.button.right.logo" template="allure/applepay/button_badge.phtml" />
        </reference>

    </catalog_product_view>

</layout>