<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2006-2019 Magento, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 *
 * @var $this Mage_Checkout_Block_Multishipping_Overview
 */
?>
<?php $steps = Mage::getSingleton('checkout/type_multishipping_state')->getSteps(); ?>
<?php $cnt = 1;?>
<div class="container">
<ol id="checkoutSteps" class="opc">
    <?php foreach ($steps as $stepKey => $_step): ?>
        <?php if($stepKey == 'multishipping_overview'): ?>
            <li id="opc-<?= $stepKey?>" title="<?= $_step->getLabel() ?>" class="section allow active" >
                <div class="step-title checkout-step-name col-12">
                    <span class="number"><?= $cnt ?></span>
                    <h3><?= $_step->getLabel() ?></h3>
                </div>
                <div class="multiple-checkout">
                    <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
                    <form action="<?= $this->getPostActionUrl() ?>" method="post" onsubmit="return showLoader();">
						<?= $this->getBlockHtml("formkey") ?>

                        <?php foreach ($this->getShippingAddresses() as $_index => $_address): ?>

                        	<div class="data-table overview-address-item" id="overview-address-item-<?= $_address->getId()?>">
                        		<div class="col-12 overview-product">
                        	<?php foreach ($this->getShippingAddressItems($_address) as $_item): ?>
                            	<?php if ($_item->getQuoteItem()) :?>
                            	<div class="row">
                            		<div class="col-lg-2 col-md-2 col-4">
                                		<?php $_product = $_item->getQuoteItem()->getProduct() ?>
                                		<?php
                                		if ($option = $_item->getOptionByCode('simple_product')) {
                                		    $_product = $option->getProduct();
                                		}
                                		?>
                                		<p class="product-image">
                                     		<img src="<?= $this->helper('catalog/image')->init($_product, 'thumbnail')->resize(74,96); ?>" width="74" height="96" alt="<?php echo $this->escapeHtml($_product->getName()) ?>" title="<?php echo $this->escapeHtml($_product->getName()) ?>" />
                                 		</p>
                                	</div>
                                	<div class="col-lg-10 col-md-10 col-12">
                                		<?php echo $this->getItemHtml($_item->getQuoteItem())?>

                                		<div class="box"></div>

                                		<div class="box">
                                            <!-- <div class="box-title">
                                                <h4><//?= $this->__('Shipping To') ?></h4>
                                            </div> -->
                                            <div class="box-content">
                                                <address>
                                                    <?= $_address->format('html') ?>
                                                </address>
                                            </div>
                                    	</div>

                                    	<div class="box">
                                            <div class="box-title">
                                                <!-- <h4><//?= $this->__('[Shipping Method]') ?></h4> -->
                                                <?php if($_rate=$this->getShippingAddressRate($_address)): ?>
                                                <?php echo $this->escapeHtml($_rate->getMethodTitle()) ?>
                                                <?php endif; ?>
                                            </div>
                                            <div class="box-content">
                                                <?php if($_rate=$this->getShippingAddressRate($_address)): ?>
                                                <p>

                                                <?php $_excl = $this->getShippingPriceExclTax($_address); ?>
                                                <?php $_incl = $this->getShippingPriceInclTax($_address); ?>
                                                <?php echo $_excl; ?>
                                                <?php if ($this->helper('tax')->displayShippingBothPrices() && $_incl != $_excl): ?>
                                                    (<?php echo $this->__('Incl. Tax'); ?> <?php echo $_incl; ?>)
                                                <?php endif; ?>
                                                </p>
                                                <?php endif; ?>
                                            </div>
                                        </div>

                                        <?php if($_address->getNoSignatureDelivery()):?>
                                        <div class="box">
                                        	<div class="box-content">
                                        		<p class="para-normal"><?= $this->__('Signature required upon delivery.')?></p>
                                        	</div>
                                        </div>
                                        <?php endif;?>

                                        <?php $message = Mage::helper('amstockstatus')->getStockMessage($_item);?>
										<?php if(!empty($message)): ?>
										<div class="box">
                                        	<div class="box-content row">
                                        		<div class="item-msg col">
                                              <p class="info-text-two"><span class="info-text-two">Availability:</span> <?php echo $message ?></p>
                                            </div>
                                            <div class="text-right overview-price-qty">
                                            <div class="">
                                              <p class="overview-dark-price"><?= $this->helper('checkout')->formatPrice($_item->getCalculationPrice())?></p>
                                            </div>
                                            <div class="overview-quantity">
                                            	<p class="para-three"><?= $this->__('Quantity: ')?><?= $this->escapeHtml(round($_item->getQty()))?></p>
                                            </div>
                                        	</div>
                                        </div>
                                        </div>
										<?php endif;?>
                                        <div class="box gift-input-section">
                                        	<div class="box-content">
                                        		<?php if($_item->getIsGiftItem()):?>
                                        		<p class="para-normal"><?= $this->__('You have marked this item as a gift. Would you like to add a gift message?')?></p>
                                        		<?= $this->getGiftItemHtml($_item)?>
                                        		<?php endif;?>
                                        	</div>
                                        </div>

                                	</div>
                            	</div>
                            	<?php endif;?>
                            <?php endforeach; ?>
                            	</div>
                            </div>
                            <script type="text/javascript">decorateTable('overview-address-item-<?= $_address->getId()?>')</script>

                        <?php endforeach; ?>

                        <div id="checkout-review-submit col-12">
                        <?php echo $this->getChildHtml('agreements') ?>
                        	<div class="place-order row">
                            	<?= $this->getChildHtml("totals");?>
                            	<div id="review-buttons-container" class="col-12 text-right">
                                	<button type="submit" title="<?php echo $this->__('Checkout') ?>" class="button btn-checkout dark-button next-button" id="review-button"><span><span><?php echo $this->__('Checkout') ?></span></span></button>
                               	</div>
                                <span class="please-wait" id="review-please-wait" style="display:none;">
                               		<img src="<?php echo $this->getSkinUrl('images/opc-ajax-loader.gif') ?>" alt="<?php echo $this->__('Submitting order information...') ?>" title="<?php echo $this->__('Submitting order information...') ?>" class="v-middle" /> <?php echo $this->__('Submitting order information...') ?>
                              	</span>
                          	</div>
                       	</div>
                        <div class="buttons-set">
                        	<p class="back-link"><a href="<?php echo $this->getBackUrl() ?>"><small>&laquo; </small><?php echo $this->__('Back to Billing Information') ?></a></p>
                       	</div>
            		</form>

                        <script type="text/javascript">
                        //<![CDATA[
                            var submitted = false;

                            function showLoader()
                            {
                                if (submitted) {
                                    return false;
                                }
                                if ($('checkout-agreements')) {
                                    var checkboxes = $$('#checkout-agreements input');
                                    for (var i=0, l=checkboxes.length; i<l; i++) {
                                        if (!checkboxes[i].checked) {
                                            alert("<?php echo $this->__('Please agree to all Terms and Conditions before placing the orders.')?>");
                                            return false;
                                        }
                                    }
                                }

                                submitted = true;
                                var step='review';
                                Element.show(step+'-please-wait');
                                $(step+'-buttons-container').setStyle({opacity:.5});
                                $(step+'-buttons-container').descendants().each(function(s) {
                                      s.disabled = true;
                                });
                                return true;
                            }
                        //]]>
                        </script>
                </div>
            </li>
        <?php else: ?>
        	<li id="opc-<?= $stepKey?>" title="<?= $_step->getLabel() ?>" class="section" >
            <?php if($stepKey == 'multishipping_addresses'):?>
            	<a href="<?php echo $this->getBaseUrl() .'checkout/multishipping/addresses/' ?>">
                	<div class="step-title checkout-step-name col-12">
                    	<span class="number"><?= $cnt ?></span>
                        <h3><?= $this->__($_step->getLabel()) ?></h3>
                   	</div>
                </a>
            <?php elseif($stepKey == 'multishipping_shipping'):?>
                <a href="<?= $this->getBaseUrl().'checkout/multishipping/shipping/'; ?>">
                	<div class="step-title checkout-step-name col-12">
                    	<span class="number"><?= $cnt ?></span>
                    	<h3><?= $_step->getLabel()?></h3>
                	</div>
                </a>
            <?php elseif($stepKey == 'multishipping_delivery_option'):?>
                <a href="<?= $this->getBaseUrl().'checkout/multishipping/delivery/'; ?>">
                	<div class="step-title checkout-step-name col-12">
                    	<span class="number"><?= $cnt ?></span>
                    	<h3><?= $_step->getLabel()?></h3>
                	</div>
                </a>
            <?php elseif($stepKey == 'multishipping_billing'):?>
                <a href="<?= $this->getBaseUrl().'checkout/multishipping/billing/'; ?>">
                	<div class="step-title checkout-step-name col-12">
                    	<span class="number"><?= $cnt ?></span>
                    	<h3><?= $_step->getLabel()?></h3>
                	</div>
                </a>
            <?php else:?>
            	<div class="step-title checkout-step-name col-12">
                	<span class="number"><?= $cnt ?></span>
                   	<h3><?= $_step->getLabel()?></h3>
              	</div>
            <?php endif; ?>
            </li>

        <?php endif; ?>
    <?php $cnt++; ?>
    <?php endforeach; ?>
</ol>
</div>
