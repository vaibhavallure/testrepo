
<style>
    #wishlist-table tfoot{
        display:block;
    }
</style>
<?php if ($this->helper('wishlist')->isAllow()) : ?>


<?php 
	$wishlistCount = 0;
	if (Mage::getSingleton('customer/session')->isLoggedIn()): ?>
   <?php
        $customer = Mage::getSingleton('customer/session')->getCustomer();
        $wishlist = Mage::getModel('wishlist/wishlist')->loadByCustomer($customer, true);
        //$wishlistCount = $wishlist->getItemsCount();
        $wishListItemCollection = $wishlist->getItemCollection();
        foreach ($wishListItemCollection as $item)
        {
        	$wishlistCount += $item->getQty();
        }
    ?>
<?php endif; ?>
<input id="wishlist-count" type="hidden" value="<?php echo $wishlistCount;?>" />

    <div class="my-wishlist">
    <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
        
            <?php if ($this->helper('wishlist')->isRssAllow() && $this->hasWishlistItems()): ?>
                <a href="<?php echo $this->helper('wishlist')->getRssUrl($this->getWishlistInstance()->getId()); ?>" class="link-rss"><?php echo $this->__('RSS Feed') ?></a>
            <?php endif; ?>    

        <form id="wishlist-view-form" action="<?php echo $this->getUrl('*/*/update', array('wishlist_id' => $this->getWishlistInstance()->getId())) ?>" method="post">
           <input type="hidden" name="form_key" value="<?php echo Mage::getSingleton('core/session')->getFormKey(); ?>" />
            <?php echo $this->getChildHtml('top'); ?>
                <table class="data-table" id="wishlist-table">
                    <thead class="shop-titles">
                        <tr>
                            <th colspan="2">
                                PRODUCT
                            </th>
                            <th class="a-center">
                                PRICE
                            </th>
                            <th class="a-center">
                                QTY
                            </th>
                             <th class="a-center">
                                SUBTOTAl
                            </th>
                            <th  class="a-center">
                                COMMENT
                            </th>
                            <!-- <th  class="a-center">
                                ADDED ON
                            </th> -->
                            <th colspan="2"> </th>
                        </tr>
                        
                        <?php if(0):?>
                        	<tr height="7px"><td class="shop-space" height="7px"></td></tr> 
                        <?php endif;?>
                        
                    </thead>
                    <tbody>
                        <?php if ($this->hasWishlistItems()): ?>
                                <?php echo $this->getBlockHtml('formkey');?>
                                <?php $this->getChild('items')->setItems($this->getWishlistItems()); ?>
                                <?php echo $this->getChildHtml('items');?>
                                <script type="text/javascript">decorateTable('wishlist-table')</script>
                        <?php else: ?>
                            <tr><td colspan="7"><p class="wishlist-empty"><?php echo $this->__('You have no items in your wishlist.') ?></p></td></tr>
                        <?php endif ?>
                        
                        <?php if(0):?>
                        <tr style="background:none !important;">
                            <td colspan="3"   style="padding:10px 0 8px 0 !important;">
                                <div class="links-wishlist"  style="padding-top:0px !important;">
                                    <ul>
                                        <?php $wishList = Mage::getModel('wishlist/wishlist')->loadByCustomer(Mage::getSingleton('customer/session')->getCustomer());?>
										 <?php if ($this->hasWishlistItems()): ?>
                                        <li><div id="mail" style="display: inline-block"><div class="button mail "><a href="<?php echo Mage::getBaseUrl() . 'wishlist/index/share/wishlist_id/' . $wishList->getWishlistId();?>"><div class="emailBtn"><img id="imgMail" src="/skin/frontend/mt/default/images/social_networking_iconpack/email_32.png"><span class="share">Email</span></div></a></div></div></li>
										<?php endif ?>
                                        <li><a href="<?php echo Mage::getBaseUrl();?>">Continue Shopping</a></li>
                                        <?php /*?><li><a href="<?php echo Mage::getBaseUrl() . "tryout/";?>">Back to Try On Studio</a></li><?php */?>
                                    </ul>
                                </div>
                            </td>
                            <td colspan="4" style="padding-top:0px !important;">
                                <div class="buttons-set buttons-set2">
                                    <?php echo $this->getChild('control_buttons')->toHtml();?>
                                </div>
                            </td>
                        </tr>
                        <?php endif;?>
                        
                    </tbody>
                </table>
        </form>
        <script type="text/javascript">
        //<![CDATA[

        jQuery(document).ready(function() {
            var reloaded = decodeURI((RegExp('reload=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]);
            if(reloaded == 1){
                jQuery('#just_added').slideDown(1000);
				jQuery('#topcart-popup').addClass('just_added');
				setTimeout(function() {
					jQuery('#just_added').slideUp(1000);  
					jQuery('#topcart-popup').removeClass('just_added');
				}, 5000);
            }
        });
        var wishlistForm = new Validation($('wishlist-view-form'));
        function addAllWItemsToCart() {

            var docHeight = jQuery(document).height();
            jQuery("body").append("<div id='overlay' class='fancybox-overlay fancybox-overlay-fixed'></div>");
            jQuery("#overlay")
                .height(docHeight)
                .show();
			jQuery.fancybox.showLoading();

            var reloaded = decodeURI((RegExp('reload=' + '(.+?)(&|$)').exec(window.location.search)||[,null])[1]);
            var url = '<?php echo $this->getUrl('*/*/allcart', array('wishlist_id' => $this->getWishlistInstance()->getId())) ?>';
            var separator = (url.indexOf('?') >= 0) ? '&' : '?';
            $$('#wishlist-view-form .item_id').each(
                function (input, index) {
					addWItemToCart2(input.value);
                }
            );
        }
        //]]>
        </script>
    </div>
    <?php echo $this->getChildHtml('bottom'); ?>
    <div class="buttons-set">
        <p class="back-link"><a href="<?php echo $this->escapeUrl($this->getBackUrl()) ?>"><small>&laquo; </small><?php echo $this->__('Back') ?></a></p>
    </div>
<?php endif ?>


<script>
jQuery(document).ready(function(){
	var wishlistCount =  jQuery("#wishlist-count").val();
	jQuery("#myaccount-wishlist-total-item").text(wishlistCount);
	jQuery("#myaccount-wishlist-total-item").show();
});
</script>


<script>
	function plusMinusToWishlist(elementId,plus){
		var qty = parseInt(jQuery(elementId).val()) + plus ;
		var form_key = jQuery(' #wishlist-view-form input').val();
	    if(qty > 0) {
	    	jQuery(elementId).val(qty);
            var item_id = jQuery(elementId).attr('data-item-id');
            var qtyData = {qty:qty};
            var cart={};
            cart[item_id] = qtyData;
            cart = JSON.stringify(cart);
            showLoadingFancybox();
			jQuery.ajax({
		        url: '<?php echo Mage::getBaseUrl('web').'wishlist/index/updateItemAjax';?>',
		        dataType : 'json',
				type : 'POST',
				data: {'cart':cart,'form_key':form_key},
		        success: function(data) {
		        	if(data.success){
		        		jQuery('.mt-my-wishlist').html("");
		        		jQuery('.mt-my-wishlist').html(data.html);
		        	}
		        	hideLoadingFancybox();
		        }
		    });
	    }
	}

	function updateWishListItem(id){
		var item_id = id;
		var form_key 	= jQuery(' #wishlist-view-form input').val();
		var description = jQuery('#wishlist-table textarea[name="description['+id+']"]').val();
		var qty 		= jQuery("#wishlist-table #qtyid_"+id).val();
		var data = {qty:qty , description:description};
        var cart={};
        cart[item_id] = data;
        cart = JSON.stringify(cart);
        showLoadingFancybox();
        jQuery.ajax({
	        url: '<?php echo Mage::getBaseUrl('web').'wishlist/index/updateItemAjax';?>',
	        dataType : 'json',
			type : 'POST',
			data: {'cart':cart,'form_key':form_key},
	        success: function(data) {
	        	if(data.success){
	        		jQuery('.mt-my-wishlist').html("");
	        		jQuery('.mt-my-wishlist').html(data.html);
	        	}
	        	hideLoadingFancybox();
	        }
	    });
	}

	function addWishlistItemToCart(id){
		var item_id = id;
		var form_key 	= jQuery(' #wishlist-view-form input').val();
		var qty 		= jQuery("#wishlist-table #qtyid_"+id).val();
		showLoadingFancybox();
        jQuery.ajax({
	        url: '<?php echo Mage::getBaseUrl('web').'wishlist/index/addCartAjax';?>',
	        dataType : 'json',
			type : 'POST',
			data: {'item':item_id,'qty':qty,'form_key':form_key},
	        success: function(data) {
	        	if(data.success){
	        		jQuery('.mt-my-wishlist').html("");
	        		jQuery('.mt-my-wishlist').html(data.html);

	        		jQuery('.mt-my-cart').html("");
		        	jQuery('.mt-my-cart').html(data.cart_html);
	                
	            	jQuery('html, body').animate({
	                    scrollTop: 0
	                }, 'fast');

	            	jQuery('#ajax_cart_content').html(data.top_cart);
	                jQuery('#just_added').slideDown(1000);
	                jQuery('#topcart-popup').addClass('just_added');
	                setTimeout(function() {
	                    jQuery('#just_added').slideUp(1000);
	                    jQuery('#topcart-popup').removeClass('just_added');
	                }, 5000);
	        	}else{
		        	alert(data.message);
	        	}
	        	hideLoadingFancybox();
	        }
	    });
	}

	function wishlistRemoveItem(id){
		var item_id = id;
		var form_key 	= jQuery(' #wishlist-view-form input').val();
		showLoadingFancybox();
		jQuery.ajax({
	        url: '<?php echo Mage::getBaseUrl('web').'wishlist/index/removeAjax';?>',
	        dataType : 'json',
			type : 'POST',
			data: {'item':item_id,'form_key':form_key},
	        success: function(data) {
	        	if(data.success){
	        		jQuery('.mt-my-wishlist').html("");
	        		jQuery('.mt-my-wishlist').html(data.html);
	        	}
	        	hideLoadingFancybox();
	        }
	    });
	}
</script>

