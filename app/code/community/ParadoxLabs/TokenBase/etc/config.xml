<?xml version="1.0" ?>
<config>
	<modules>
		<ParadoxLabs_TokenBase>
			<version>2.3.5.20171006</version>
		</ParadoxLabs_TokenBase>
	</modules>
	<global>
		<blocks>
			<tokenbase>
				<class>ParadoxLabs_TokenBase_Block</class>
			</tokenbase>
		</blocks>
		<helpers>
			<tokenbase>
				<class>ParadoxLabs_TokenBase_Helper</class>
			</tokenbase>
		</helpers>
		<models>
			<tokenbase>
				<class>ParadoxLabs_TokenBase_Model</class>
				<resourceModel>tokenbase_resource</resourceModel>
			</tokenbase>
			<tokenbase_resource>
				<class>ParadoxLabs_TokenBase_Model_Resource</class>
				<entities>
					<card>
						<table>paradoxlabs_stored_card</table>
					</card>
				</entities>
			</tokenbase_resource>
		</models>
		<resources>
			<tokenbase_setup>
				<setup>
					<module>ParadoxLabs_TokenBase</module>
					<class>Mage_Sales_Model_Mysql4_Setup</class>
				</setup>
				<connection>
					<use>core_setup</use>
				</connection>
			</tokenbase_setup>
			<tokenbase_write>
				<connection>
					<use>core_write</use>
				</connection>
			</tokenbase_write>
			<tokenbase_read>
				<connection>
					<use>core_read</use>
				</connection>
			</tokenbase_read>
		</resources>
		<events>
			<!-- Add proper support for partial refunds. -->
			<sales_order_creditmemo_refund>
				<observers>
					<tokenbase_refund>
						<class>tokenbase/observer_refund</class>
						<method>processRefund</method>
					</tokenbase_refund>
				</observers>
			</sales_order_creditmemo_refund>
			<sales_order_payment_capture>
				<observers>
					<tokenbase_capture>
						<class>tokenbase/observer_capture</class>
						<method>processCapture</method>
					</tokenbase_capture>
				</observers>
			</sales_order_payment_capture>
			<tokenbase_before_load_active_cards>
				<observers>
					<tokenbase_check_queue_deletion>
						<class>tokenbase/observer_cardLoad</class>
						<method>checkQueuedForDeletion</method>
					</tokenbase_check_queue_deletion>
				</observers>
			</tokenbase_before_load_active_cards>
			<sales_model_service_quote_submit_failure>
				<observers>
					<tokenbase_ensure_checkout_card_save>
						<class>tokenbase/observer_checkoutFailure</class>
						<method>ensureCardSave</method>
					</tokenbase_ensure_checkout_card_save>
				</observers>
			</sales_model_service_quote_submit_failure>
			<controller_action_predispatch_customer_paymentinfo_delete>
				<observers>
					<tokenbase_fraud>
						<class>tokenbase/observer_paymentInfoAuthenticate</class>
						<method>paymentInfoAuthenticate</method>
					</tokenbase_fraud>
				</observers>
			</controller_action_predispatch_customer_paymentinfo_delete>
			<controller_action_predispatch_customer_paymentinfo_index>
				<observers>
					<tokenbase_fraud>
						<class>tokenbase/observer_paymentInfoAuthenticate</class>
						<method>paymentInfoAuthenticate</method>
					</tokenbase_fraud>
				</observers>
			</controller_action_predispatch_customer_paymentinfo_index>
			<controller_action_predispatch_customer_paymentinfo_save>
				<observers>
					<tokenbase_fraud>
						<class>tokenbase/observer_paymentInfoAuthenticate</class>
						<method>paymentInfoAuthenticate</method>
					</tokenbase_fraud>
				</observers>
			</controller_action_predispatch_customer_paymentinfo_save>
		</events>
		<fieldsets>
			<sales_convert_quote_payment>
				<tokenbase_id>
					<to_order_payment>*</to_order_payment>
				</tokenbase_id>
				<echeck_account_name>
					<to_order_payment>*</to_order_payment>
				</echeck_account_name>
				<echeck_bank_name>
					<to_order_payment>*</to_order_payment>
				</echeck_bank_name>
				<echeck_account_type>
					<to_order_payment>*</to_order_payment>
				</echeck_account_type>
				<echeck_routing_number>
					<to_order_payment>*</to_order_payment>
				</echeck_routing_number>
				<echeck_routing_no>
					<to_order_payment>*</to_order_payment>
				</echeck_routing_no>
				<echeck_account_no>
					<to_order_payment>*</to_order_payment>
				</echeck_account_no>
			</sales_convert_quote_payment>
			<sales_convert_order_payment>
				<tokenbase_id>
					<to_quote_payment>*</to_quote_payment>
				</tokenbase_id>
				<echeck_account_name>
					<to_quote_payment>*</to_quote_payment>
				</echeck_account_name>
				<echeck_bank_name>
					<to_quote_payment>*</to_quote_payment>
				</echeck_bank_name>
				<echeck_account_type>
					<to_quote_payment>*</to_quote_payment>
				</echeck_account_type>
				<echeck_routing_number>
					<to_quote_payment>*</to_quote_payment>
				</echeck_routing_number>
				<echeck_routing_no>
					<to_quote_payment>*</to_quote_payment>
				</echeck_routing_no>
				<echeck_account_no>
					<to_quote_payment>*</to_quote_payment>
				</echeck_account_no>
			</sales_convert_order_payment>
		</fieldsets>
		<!-- Define implementing payment methods - each method will add its entry to this. -->
		<!-- The method key should match its configuration path and shortcode: payment/{code} -->
		<tokenbase>
			<methods />
		</tokenbase>
	</global>
	<crontab>
		<jobs>
			<!-- Run maintenance operations regarding stored payment data. -->
			<tokenbase_clean>
				<schedule>
					<cron_expr>0 5 * * *</cron_expr>
				</schedule>
				<run>
					<model>tokenbase/cron_clean::cleanData</model>
				</run>
			</tokenbase_clean>
		</jobs>
	</crontab>
	<default>
		<payment_services>
			<tokenbase>
				<clean_old_cards>1</clean_old_cards>
				<failure_limit>5</failure_limit>
				<failure_window>86400</failure_window>
				<paymentinfo_require_order>1</paymentinfo_require_order>
			</tokenbase>
		</payment_services>
	</default>
	<frontend>
		<routers>
			<!-- Attach our account management page onto the Customer module. -->
			<customer>
				<args>
					<modules>
						<ParadoxLabs_TokenBase before="Mage_Customer">ParadoxLabs_TokenBase_Customer</ParadoxLabs_TokenBase>
					</modules>
				</args>
			</customer>
		</routers>
		<layout>
			<updates>
				<tokenbase module="ParadoxLabs_TokenBase">
					<file>ParadoxLabs_TokenBase.xml</file>
				</tokenbase>
			</updates>
		</layout>
	</frontend>
	<admin>
		<routers>
			<adminhtml>
				<args>
					<modules>
						<tokenbase before="Mage_Adminhtml">ParadoxLabs_TokenBase_Adminhtml</tokenbase>
					</modules>
				</args>
			</adminhtml>
		</routers>
	</admin>
	<adminhtml>
		<layout>
			<updates>
				<tokenbase module="ParadoxLabs_TokenBase">
					<file>ParadoxLabs_TokenBase.xml</file>
				</tokenbase>
			</updates>
		</layout>
		<events>
			<controller_action_predispatch>
				<observers>
					<tokenbase_notification>
						<class>tokenbase/observer_feed</class>
						<method>observe</method>
					</tokenbase_notification>
				</observers>
			</controller_action_predispatch>
			<controller_action_predispatch_adminhtml_centinel_index_validatepaymentdata>
				<observers>
					<tokenbase_notification>
						<class>tokenbase/observer_centinelValidate</class>
						<method>updatePaymentInfo</method>
					</tokenbase_notification>
				</observers>
			</controller_action_predispatch_adminhtml_centinel_index_validatepaymentdata>
		</events>
	</adminhtml>
</config>