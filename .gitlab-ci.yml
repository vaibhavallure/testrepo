before_script:
  - echo 'Start Deployment'
stages:
  - develop
  - alpha
  - beta
  - deploy
develop:
  environment: development
  stage: develop
  tags:
    - development
  only:
    - development
  script:
    - mage-deploy mariatash
    - echo 'Deployed on Allure Local Dev'
cloud_alpha:
  environment: staging
  stage: alpha
  tags:
    - cloud-alpha
  only:
    - bugfixes
  script:
    - mage-deploy mt
    - echo 'Deployed on Staging'

beta_stage:
  environment: alpha
  stage: beta
  tags:
    - alpha
  only:
    - master
  script:
    - deploy-magento mariatash
    - rm -f media && ln -s /var/www/shared/mariatash/media media
    - rm -f var && ln -s /var/www/shared/mariatash/var var
    - rm -f app/etc/local.xml && ln -s /var/www/shared/mariatash/etc/local.xml app/etc/local.xml
    - echo 'Deployed on Beta Staging'
    
beta_apple_pay:
  environment: apple_pay
  stage: staging
  tags:
    - alpha
  only:
    - apple_pay
  script:
    - deploy-magento applepay-mariatash
    - rm -f media && ln -s /var/www/shared/media/applepay-mariatash media
    - rm -f var && ln -s /var/www/shared/var/applepay-mariatash var
    - rm -f app/etc/local.xml && ln -s /var/www/shared/etc/applepay-mariatash/local.xml app/etc/local.xml
    - echo 'Deployed on ApplePay Staging'

deploy-cloud:
  environment: production
  stage: deploy
  tags:
    - production
  only:
    - production
  script:
    - mage-deploy
    - echo 'Deployed on Production'

